<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ØªØ¬Ø±Ø¨Ø© AR: ÙƒØ±Ø³ÙŠ ÙÙŠ Ø§Ù„ØºØ±ÙØ© + Ø¬Ø²Ù…Ø© ÙÙˆÙ‚ Ø§Ù„Ù‚Ø¯Ù… (Ù…Ø¬Ø§Ù†ÙŠ)</title>
  <meta name="description" content="ØªØ¬Ø±Ø¨Ø© ÙˆØ§Ù‚Ø¹ Ù…Ø¹Ø²Ø² Ù…Ø¬Ø§Ù†ÙŠØ©: Ø¹Ø±Ø¶ ÙƒØ±Ø³ÙŠ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙÙŠ Ø§Ù„ØºØ±ÙØ©ØŒ ÙˆØªØ¬Ø±Ø¨Ø© Ø¬Ø²Ù…Ø© ÙÙˆÙ‚ Ø§Ù„Ù‚Ø¯Ù… Ø¨ØªØªØ¨Ù‘Ø¹ Ø¨Ø³ÙŠØ·." />
  <style>
    :root { --bg:#0f1115; --card:#161a22; --muted:#9aa4b2; --acc:#2dd4bf; --radius:14px; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    header{padding:18px 20px;border-bottom:1px solid #222833;display:flex;gap:10px;align-items:center;justify-content:space-between}
    header h1{font-size:16px;margin:0;font-weight:600;letter-spacing:.2px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab-btn{background:#1e2430;color:#cfd6e4;border:1px solid #2a3242;padding:10px 14px;border-radius:10px;cursor:pointer}
    .tab-btn.active{background:var(--acc);color:#062926;border-color:transparent;font-weight:700}
    main{padding:18px}
    .panel{display:none}
    .panel.active{display:block}
    .card{background:var(--card);border:1px solid #242b38;border-radius:var(--radius);padding:16px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .hint{color:var(--muted);font-size:14px;line-height:1.6}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    button, .link-btn{
      appearance:none;background:#2b3344;color:#dbe3f3;border:1px solid #364056;border-radius:10px;
      padding:10px 14px;cursor:pointer
    }
    button.primary{background:var(--acc);color:#062926;border-color:transparent;font-weight:700}
    .badge{font-size:12px;color:#a7b2c6;background:#232a36;border:1px solid #2d3748;border-radius:999px;padding:4px 10px}
    /* model-viewer wrapper */
    .mv-wrap{border-radius:12px;overflow:hidden;border:1px solid #283142}
    model-viewer{width:100%;height:70vh;background:#0b0e15}
    /* shoe try-on */
    .camera-wrap{position:relative;width:100%;max-width:900px;margin-inline:auto;border-radius:12px;overflow:hidden;border:1px solid #283142}
    video#cam{width:100%;height:auto;display:block;transform:scaleX(-1);} /* mirror view */
    canvas#debug{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;transform:scaleX(-1);}
    img#shoeOverlay{
      position:absolute;left:0;top:0;width:220px;opacity:0.95;pointer-events:none;
      display:none; transform-origin:center center; /* will be rotated/scaled/translated */
      filter:drop-shadow(0 10px 18px rgba(0,0,0,.35))
    }
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .note{font-size:12px;color:#a9b3c4}
    footer{padding:16px;color:#808aa0;text-align:center;border-top:1px solid #222833}
    a{color:#7dd3fc;text-decoration:none}
  </style>

  <!-- model-viewer (AR Ù„Ù„ÙƒØ±Ø³ÙŠ) -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script>

  <!-- MediaPipe Pose (Ù…Ø¬Ø§Ù†ÙŠ) + Ø£Ø¯ÙˆØ§Øª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ø±Ø³Ù… -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
</head>
<body>

  <header>
    <h1>ØªØ¬Ø±Ø¨Ø© ÙˆØ§Ù‚Ø¹ Ù…Ø¹Ø²Ø² Ù…Ø¬Ø§Ù†ÙŠØ©</h1>
    <div class="tabs">
      <button class="tab-btn active" data-tab="chair">AR ÙƒØ±Ø³ÙŠ ÙÙŠ Ø§Ù„ØºØ±ÙØ©</button>
      <button class="tab-btn" data-tab="shoe">ØªØ¬Ø±Ø¨Ø© Ø¬Ø²Ù…Ø© (ØªØªØ¨ÙÙ‘Ø¹ Ù‚Ø¯Ù…)</button>
    </div>
  </header>

  <main>
    <!-- Panel 1: ÙƒØ±Ø³ÙŠ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø¯Ø§Ø®Ù„ Ø§Ù„ØºØ±ÙØ© -->
    <section id="panel-chair" class="panel active">
      <div class="grid">
        <div class="card">
          <div class="row">
            <span class="badge">Ù…Ø¬Ø§Ù†ÙŠ â€¢ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ Ùˆ iOS</span>
          </div>
          <p class="hint">
            Ø§Ø¶ØºØ· Ø²Ø± <b>AR</b> Ø«Ù… ÙˆØ¬Ù‘Ù‡ Ø§Ù„Ø¬ÙˆØ§Ù„ Ù†Ø­Ùˆ Ø§Ù„Ø£Ø±Ø¶ Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙƒØ±Ø³ÙŠ.  
            Ø¹Ù„Ù‰ Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ ÙŠÙÙØªØ­ Scene ViewerØŒ ÙˆØ¹Ù„Ù‰ iOS ÙŠÙÙØªØ­ Quick Look.  
          </p>
          <div class="mv-wrap">
            <model-viewer id="chairMV"
              src="https://modelviewer.dev/shared-assets/models/Chair.glb"
              ios-src="https://modelviewer.dev/shared-assets/models/Chair.usdz"
              ar ar-modes="webxr scene-viewer quick-look"
              camera-controls environment-image="neutral"
              exposure="0.9" shadow-intensity="1"
              poster="https://modelviewer.dev/assets/posters/shishkebab.png"
              alt="ÙƒØ±Ø³ÙŠ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ØºØ±ÙØ©">
              <button slot="ar-button" class="primary" style="position:absolute;bottom:16px;left:16px;">
                ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ø§Ù„ØºØ±ÙØ© (AR)
              </button>
              <div class="note" slot="progress-bar" style="position:absolute;left:16px;bottom:56px;">
                ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬...
              </div>
            </model-viewer>
          </div>
          <div class="controls">
            <button id="swapChair">ØªØ¨Ø¯ÙŠÙ„ Ù„ÙƒØ±Ø³ÙŠ Ø¢Ø®Ø±</button>
            <span class="note">Ù†Ù…Ø§Ø°Ø¬ Ù…Ù† <a href="https://modelviewer.dev/" target="_blank" rel="noopener">modelviewer.dev</a></span>
          </div>
        </div>
      </div>
    </section>

    <!-- Panel 2: ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¬Ø²Ù…Ø© Ù…Ø¹ ØªØªØ¨Ø¹ Ù‚Ø¯Ù… (ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ø¬Ø§Ù†ÙŠ) -->
    <section id="panel-shoe" class="panel">
      <div class="card">
        <div class="row">
          <span class="badge">ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ø¬Ø§Ù†ÙŠ</span>
          <span class="note">ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ MediaPipe PoseØ› Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§Ø¡Ø© Ø¬ÙŠØ¯Ø© ÙˆÙˆØ¶ÙˆØ­ Ø§Ù„Ù‚Ø¯Ù…</span>
        </div>
        <div class="camera-wrap">
          <video id="cam" playsinline></video>
          <canvas id="debug"></canvas>
          <!-- ØµÙˆØ±Ø© Ø¬Ø²Ù…Ø© PNG Ø´ÙØ§ÙØ© Ù…Ù† Ù…ØµØ¯Ø± Ø¹Ø§Ù… (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·) -->
          <img id="shoeOverlay"
               src="https://upload.wikimedia.org/wikipedia/commons/6/6a/Sneaker_icon_transparent.png"
               alt="Overlay Shoe">
        </div>
        <div class="controls">
          <button id="startShoe" class="primary">Ø¨Ø¯Ø¡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØªØªØ¨Ø¹ Ø§Ù„Ù‚Ø¯Ù…</button>
          <button id="stopShoe">Ø¥ÙŠÙ‚Ø§Ù</button>
          <select id="footSelect">
            <option value="auto">ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ø£Ù‚Ø±Ø¨ Ù‚Ø¯Ù…)</option>
            <option value="left">Ø§Ù„Ù‚Ø¯Ù… Ø§Ù„ÙŠØ³Ø±Ù‰</option>
            <option value="right">Ø§Ù„Ù‚Ø¯Ù… Ø§Ù„ÙŠÙ…Ù†Ù‰</option>
          </select>
          <label class="note">
            ØªØ­ÙƒÙ… ÙŠØ¯ÙˆÙŠ Ø¨Ø§Ù„Ø­Ø¬Ù…:
            <input id="scaleRange" type="range" min="0.6" max="2.0" step="0.02" value="1">
          </label>
        </div>
        <p class="hint" style="margin-top:10px">
          ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø¶Ø¹ Ø§Ù„Ø¬ÙˆØ§Ù„ Ø¹Ù„Ù‰ Ø­Ø§Ù…Ù„ ÙˆÙˆØ¬Ù‘Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù‚Ø¯Ù…ÙŠÙƒ. Ø§Ù„Ø£ÙØ¶Ù„ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù‚Ø¯Ù… Ø¸Ø§Ù‡Ø±Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ø§Ù„ÙƒØ§Ø¯Ø±.
        </p>
      </div>
    </section>
  </main>

  <footer>
    Ù‡Ø°Ø§ Ù†Ù…ÙˆØ°Ø¬ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ø¬Ø§Ù†ÙŠ. Ù„ØªØªØ¨Ù‘Ø¹ Ø¯Ù‚ÙŠÙ‚ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ù…Ø«Ù„ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§ØªØŒ Ø³ØªØ­ØªØ§Ø¬ SDK Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…Ø¯ÙÙˆØ¹.
  </footer>

<script>
  // ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª
  const tabs = document.querySelectorAll('.tab-btn');
  const panels = {
    chair: document.getElementById('panel-chair'),
    shoe: document.getElementById('panel-shoe')
  };
  tabs.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      tabs.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.dataset.tab;
      Object.values(panels).forEach(p=>p.classList.remove('active'));
      panels[tab].classList.add('active');
    });
  });

  // ØªØ¨Ø¯ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙƒØ±Ø³ÙŠ
  const chairMV = document.getElementById('chairMV');
  const swapBtn = document.getElementById('swapChair');
  let altChair = false;
  swapBtn.addEventListener('click', ()=>{
    if(!altChair){
      chairMV.src = "https://modelviewer.dev/shared-assets/models/ChairRed.glb";
      chairMV.setAttribute('ios-src', "https://modelviewer.dev/shared-assets/models/Chair.usdz"); // Ù†ÙØ³ USDZ Ù„Ù„ØªØ¬Ø±Ø¨Ø©
      swapBtn.textContent = "Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙƒØ±Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„";
    } else {
      chairMV.src = "https://modelviewer.dev/shared-assets/models/Chair.glb";
      chairMV.setAttribute('ios-src', "https://modelviewer.dev/shared-assets/models/Chair.usdz");
      swapBtn.textContent = "ØªØ¨Ø¯ÙŠÙ„ Ù„ÙƒØ±Ø³ÙŠ Ø¢Ø®Ø±";
    }
    altChair = !altChair;
  });

  /* ====== ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¬Ø²Ù…Ø© (MediaPipe Pose) ====== */
  const videoEl = document.getElementById('cam');
  const canvasEl = document.getElementById('debug');
  const ctx = canvasEl.getContext('2d');
  const shoeImg = document.getElementById('shoeOverlay');
  const startBtn = document.getElementById('startShoe');
  const stopBtn  = document.getElementById('stopShoe');
  const footSelect = document.getElementById('footSelect');
  const scaleRange = document.getElementById('scaleRange');

  let camera = null;
  let pose = null;
  let running = false;

  // Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©
  function setCanvasSizeToVideo() {
    const rect = videoEl.getBoundingClientRect();
    canvasEl.width = rect.width;
    canvasEl.height = rect.height;
  }

  // ØªØ­ÙˆÙŠÙ„ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª normalized [0..1] Ø¥Ù„Ù‰ Ø¨ÙƒØ³Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ <video> Ø§Ù„Ù…Ø¹ÙƒÙˆØ³
  function toPixel(xNorm, yNorm) {
    // Ù„Ø£Ù†Ù†Ø§ Ø¹ÙƒØ³Ù†Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø£ÙÙ‚ÙŠØ§Ù‹ (mirror), x Ù†Ø¹ÙƒØ³Ù‡
    const x = (1 - xNorm) * canvasEl.width;
    const y = yNorm * canvasEl.height;
    return {x, y};
  }

  // ÙŠØ¹ÙŠØ¯ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ù…Ø¹Ù‚ÙˆÙ„Ø© Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚Ø¯Ù…
  // BlazePose (33 landmark): Ù†ÙØªØ±Ø¶ Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„ØªØ§Ù„ÙŠØ©:
  // left_ankle=27, right_ankle=28, left_heel=29, right_heel=30, left_foot_index=31, right_foot_index=32
  function getFootPoints(landmarks, which='auto') {
    if (!landmarks || landmarks.length < 33) return null;

    const L = {
      ankle: landmarks[27], heel: landmarks[29], toe: landmarks[31]
    };
    const R = {
      ankle: landmarks[28], heel: landmarks[30], toe: landmarks[32]
    };

    function footScore(p) {
      // ÙƒÙ„Ù…Ø§ ÙƒØ§Ù†Øª Z Ø£ØµØºØ± (Ø£Ù‚Ø±Ø¨ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§) ÙˆØ¨Ù…Ø±ÙƒØ² Ø§Ù„Ø´Ø§Ø´Ø©ØŒ Ù†Ø¹Ø·ÙŠÙ‡ ÙˆØ²Ù† Ø£Ø¹Ù„Ù‰
      const dx = p.ankle.x - 0.5, dy = p.ankle.y - 0.5;
      const centerDist = Math.hypot(dx, dy);
      return (1 - centerDist) + (p.ankle.visibility || 0) + (p.toe.visibility || 0);
    }

    let selected = null;
    if (which === 'left') selected = L;
    else if (which === 'right') selected = R;
    else {
      selected = (footScore(L) >= footScore(R)) ? L : R;
    }
    return selected;
  }

  // ÙˆØ¶Ø¹ ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø²Ù…Ø© ÙÙˆÙ‚ Ø§Ù„Ù‚Ø¯Ù…
  function placeShoe(landmarks, manualScale = 1) {
    const foot = getFootPoints(landmarks, footSelect.value);
    if (!foot || !foot.ankle || !foot.toe) {
      shoeImg.style.display = 'none';
      return;
    }

    // Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ù‚Ø¯Ù… Ù…Ù† Ø®Ø· (Ø§Ù„ÙƒØ§Ø­Ù„ -> Ø¥ØµØ¨Ø¹ Ø§Ù„Ù‚Ø¯Ù…)
    const dx = (foot.toe.x - foot.ankle.x);
    const dy = (foot.toe.y - foot.ankle.y);
    const angleRad = Math.atan2(dy, dx);
    const angleDeg = -angleRad * 180 / Math.PI; // Ø³Ø§Ù„Ø¨ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ù€ mirror

    // Ù…Ù‚ÙŠØ§Ø³ Ø¨Ø§Ù„Ø­Ø¬Ù…: Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„ÙƒØ§Ø­Ù„ ÙˆØ§Ù„Ø£ØµØ¨Ø¹ Ù†Ø³Ø¨Ø©Ù‹ Ø¥Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ø¯Ø±
    const dist = Math.hypot(dx, dy); // normalized
    const basePixels = dist * canvasEl.width; // ØªÙ‚Ø±ÙŠØ¨ Ù„Ø­Ø¬Ù… Ø§Ù„Ù‚Ø¯Ù… Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„
    const scale = Math.max(0.6, Math.min(2.0, (basePixels / 160))) * parseFloat(manualScale);

    // Ù…Ø±ÙƒØ² Ø§Ù„ØªØ«Ø¨ÙŠØª: Ù†Ù‚Ø·Ø© Ù…Ù†ØªØµÙ Ø¨ÙŠÙ† Ø§Ù„ÙƒØ§Ø­Ù„ ÙˆØ§Ù„Ø£ØµØ¨Ø¹
    const cx = (foot.ankle.x + foot.toe.x) / 2;
    const cy = (foot.ankle.y + foot.toe.y) / 2;
    const {x:px, y:py} = toPixel(cx, cy);

    const w = 220 * scale; // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¬ÙŠÙ…
    const h = 100 * scale; // Ø§Ø±ØªÙØ§Ø¹ ØªÙ‚Ø±ÙŠØ¨ÙŠ
    // Ù†Ø­Ø§ÙˆÙ„ Ø¥Ù†Ø²Ø§Ù„Ù‡Ø§ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„Ø£Ø³ÙÙ„ Ù„ØªØ¬Ù„Ø³ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø¯Ù…
    const offsetY = 0.02 * canvasEl.height;

    shoeImg.style.display = 'block';
    shoeImg.style.width = `${w}px`;
    shoeImg.style.height = `${h}px`;
    shoeImg.style.transform = `translate(${px - w/2}px, ${py - h/2 + offsetY}px) rotate(${angleDeg}deg)`;
  }

  // ØªØ´ØºÙŠÙ„ MediaPipe Pose
  async function initPose() {
    if (pose) return;
    pose = new Pose.Pose({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
    });
    pose.setOptions({
      modelComplexity: 1,
      smoothLandmarks: true,
      enableSegmentation: false,
      minDetectionConfidence: 0.6,
      minTrackingConfidence: 0.6,
    });
    pose.onResults(onResults);
  }

  function onResults(results) {
    // Ø±Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØµØ­ÙŠØ­
    setCanvasSizeToVideo();
    ctx.clearRect(0, 0, canvasEl.width, canvasEl.height);
    if (results.poseLandmarks) {
      // Ø®Ø·ÙˆØ·/Ù†Ù‚Ø§Ø· Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¨Ø³ÙŠØ·Ø©
      const lms = results.poseLandmarks;
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù‚Ø¯Ù… Ù…Ø®ØªØ§Ø±Ø© Ùˆ Ø±Ø³Ù… Ø®Ø· Ø¨ÙŠÙ† Ø§Ù„ÙƒØ§Ø­Ù„ ÙˆØ§Ù„Ø£ØµØ¨Ø¹
      const foot = getFootPoints(lms, footSelect.value);
      if (foot && foot.ankle && foot.toe) {
        const p1 = toPixel(foot.ankle.x, foot.ankle.y);
        const p2 = toPixel(foot.toe.x, foot.toe.y);
        ctx.strokeStyle = 'rgba(45,212,191,0.9)';
        ctx.lineWidth = 4;
        ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
        ctx.fillStyle = 'rgba(125,211,252,0.95)';
        ctx.beginPath(); ctx.arc(p1.x, p1.y, 6, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(p2.x, p2.y, 6, 0, Math.PI*2); ctx.fill();
      }
      placeShoe(lms, scaleRange.value);
    } else {
      shoeImg.style.display = 'none';
    }
  }

  async function startCamera() {
    await initPose();
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ø¨Ø± MediaPipe CameraUtils
    camera = new Camera(videoEl, {
      onFrame: async () => {
        if (!pose) return;
        await pose.send({image: videoEl});
      },
      width: 640, height: 480
    });
    await camera.start();
    running = true;
    setCanvasSizeToVideo();
  }

  async function stopCamera() {
    running = false;
    if (camera && camera.stop) {
      await camera.stop();
    }
    shoeImg.style.display = 'none';
    ctx.clearRect(0,0,canvasEl.width, canvasEl.height);
  }

  startBtn.addEventListener('click', startCamera);
  stopBtn.addEventListener('click', stopCamera);
  scaleRange.addEventListener('input', ()=>{/* Ø³ÙŠÙØ¤Ø®Ø° Ø¨Ø§Ù„Ø­Ø³Ø¨Ø§Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù‚Ø§Ø¯Ù… */});

  // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ù‚ÙŠØ§Ø³ Ø§Ù„Ù„ÙˆØ­Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
  window.addEventListener('resize', setCanvasSizeToVideo, {passive:true});
</script>
</body>
</html>
